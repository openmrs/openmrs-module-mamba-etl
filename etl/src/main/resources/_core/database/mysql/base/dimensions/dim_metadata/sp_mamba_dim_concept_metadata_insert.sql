USE analysis;

-- $BEGIN

SET @report_data = '
{
   "flat_report_metadata":[
      {
         "report_name":"HTS Report",
         "flat_table_name":"flat_encounter_hts",
         "encounter_type_uuid":"79c1f50f-f77d-42e2-ad2a-d29304dde2fe",
         "table_columns":{
            "test_setting":"13abe5c9-6de2-4970-b348-36d352ee8eeb",
            "community_service_point":"74a3b695-30f7-403b-8f63-3f766461e104",
            "facility_service_point":"80bcc9c1-e328-47e8-affe-6d1bffe4adf1",
            "hts_approach":"9641ead9-8821-4898-b633-a8e96c0933cf",
            "pop_type":"166432AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "key_pop_type":"d3d4ae96-8c8a-43db-a9dc-dac951f5dcb3",
            "key_pop_migrant_worker":"63ea75cb-205f-4e7b-9ede-5f9b8a4dda9f",
            "key_pop_uniformed_forces":"b282bb08-62a7-42c2-9bea-8751c267d13e",
            "key_pop_transgender":"22b202fc-67de-4af9-8c88-46e22559d4b2",
            "key_pop_AGYW":"678f3144-302f-493e-ba22-7ec60a84732a",
            "key_pop_fisher_folk":"def00c73-f6d5-42fb-bcec-0b192b5be22d",
            "key_pop_prisoners":"8da9bf92-22f6-40be-b468-1ad08de7d457",
            "key_pop_refugees":"dc1058ea-4edd-4780-aeaa-a474f7f3a437",
            "key_pop_msm":"160578AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "key_pop_fsw":"160579AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "key_pop_truck_driver":"162198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "key_pop_pwd":"365371fd-0106-4a53-abc4-575e3d65d372",
            "key_pop_pwid":"c038bff0-8e33-408c-b51f-7fb6448d2f6c",
            "sexually_active":"160109AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "unprotected_sex_last_12mo":"159218AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "sti_last_6mo":"156660AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "ever_tested_hiv":"1492AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "duration_since_last_test":"e7947a45-acff-49e1-ba1c-33e43a710e0d",
            "last_test_result":"159427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "reason_for_test":"ce3816e7-082d-496b-890b-a2b169922c22",
            "pretest_counselling":"de32152d-93b0-412a-908a-20af0c46f215",
            "type_pretest_counselling":"0473ec07-2f34-4447-9c58-e35a1c491b6f",
            "consent_provided":"1710AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "test_conducted":"164401AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "date_test_conducted":"164400AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "initial_kit_name":"afa64df8-50af-4bc3-8135-6e6603f62068",
            "initial_test_result":"e767ba5d-7560-43ba-a746-2b0ff0a2a513",
            "confirmatory_kit_name":"b78d89e7-08aa-484f-befb-1e3e70cd6985",
            "tiebreaker_kit_name":"73434a78-e4fc-42f7-a812-f30f3b3cabe3",
            "tiebreaker_test_result":"bfc5fbb9-2b23-422e-a741-329bb2597032",
            "final_test_result":"e16b0068-b6a2-46b7-aba9-e3be00a7b4ab",
            "syphilis_test_result":"165303AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "given_result":"164848AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "date_given_result":"160082AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "result_received_couple":"445846e9-b929-4519-bc83-d51c051918f5",
            "couple_result":"5f38bc97-d6ca-43f8-a019-b9a9647d0c6a",
            "recency_consent":"976ca997-fb2b-4bef-a299-f7c9e16b50a8",
            "recency_test_done":"4fe5857e-c804-41cf-b3c9-0acc1f516ab7",
            "recency_test_type":"05112308-79ba-4e00-802e-a7576733b98e",
            "recency_rtri_result":"165092AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "recency_vl_result":"856AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "tb_symptoms":"159800AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "tb_symptoms_fever":"1494AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "tb_symptoms_cough":"159799AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "tb_symptoms_hemoptysis":"138905AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "tb_symptoms_nightsweats":"133027AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "sti_symptoms":"c4f81292-61a3-4561-a4ae-78be7d16d928",
            "sti_symptoms_female_genitalulcers":"153872AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "sti_symptoms_genitalsores":"faf06026-fce9-4d2c-9ef2-24fb45343804",
            "sti_symptoms_lower_abdominalpain":"06be8996-ef55-438b-bbb9-5bebeb18e779",
            "sti_symptoms_scrotalmass":"d8e46cc0-4d08-45d9-a46d-bd083db63057",
            "sti_symptoms_male_genitalulcers":"123861AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "sti_symptoms_urethral_discharge":"60817acb-90f1-4d46-be87-2c47e150770b",
            "sti_symptomsVaginal_discharge":"9a24bedc-d42c-422e-9f5d-371b59af0660",
            "client_linked_care":"e8e8fe71-adbb-48e7-b531-589985094d30",
            "facility_referred_care":"161562AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_for_services":"494117dd-c763-4374-8402-5ed91bd9b8d0",
            "referred_prevention_services":"5832db34-152d-4ead-a591-c627683c7f05",
            "referred_srh_services":"7ea48919-1cfd-46fd-9ea0-8255d596e463",
            "referred_clinical_services":"ca0b979e-d69a-43d3-bbea-9b24290b021e",
            "referred_support_services":"fbe382b6-6f01-49ff-a6c9-19c1cb50b916",
            "referred_prevention_services":"5f394708-ca7d-4558-8d23-a73de181b02d",
            "referred_preexposure_services":"88cdde2b-753b-48ac-a51a-ae5e1ab24846",
            "referred_postexposure_services":"1691AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_vmmc_services":"162223AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_harmreduction_services":"da0238c1-0ddd-49cc-b10d-c552391b6332",
            "referred_behavioural_services":"ac2e75dc-fceb-4591-9ffb-3f852c0750d9",
            "referred_postgbv_services":"0be6a668-b4ff-4fc5-bbae-0e2a86af1bd1",
            "referred_prevention_info_services":"e7ee9ec2-3cc7-4e59-8172-9fd08911e8c5",
            "referred_other_prevention_services":"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_srh_services":"bf634be9-197a-433b-8e4e-7a04242a4e1d",
            "referred_hiv_partner_kpcontacts_testing":"a56cdd43-f2eb-49d6-88fd-113aaea2e85f",
            "referred_hiv_partner_testing":"f0589be1-d457-4138-b244-bfb115cdea21",
            "referred_sti_testing_tx":"46da10c7-49e3-45e5-8e82-7c529d52a1a8",
            "referred_analcancer_screening":"9d4c029a-2ac3-44c3-9a20-fb32c81a9ba2",
            "referred_cacx_screening_tx":"060dd5b2-2d65-4db5-85f0-cd1ba809350f",
            "referred_pregnancy_check":"0097d9b1-6758-4754-8713-91638efe12ea",
            "referred_contraception_fp":"6488e62a-314b-49da-b8d4-ca9c7a6941fc",
            "referred_srh_other":"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_clinical_services":"960f2980-35e2-4677-88ed-79424fe0fc91",
            "referred_tb_program":"160541AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_ipt_rogram":"164128AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_ctx_services":"858f0f06-bc62-4b04-b864-cef98a2f3845",
            "referred_vaccinations_services":"0cf2ce2c-cd3f-478b-89b7-542018674dba",
            "referred_other_clinical_services":"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_other_support":"b5afd495-00fc-4d94-9e26-8f6c8cc8caa0",
            "referred_psychosocial_support":"5490AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_mentalhealth_support":"5489AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "referred_violence_support":"ea08440d-41d4-4795-bb4d-4639cf32645c",
            "referred_legal_support":"a046ce31-e0d9-4044-a384-ecc429dc4035",
            "referred_disclosure_support":"846a63c0-4530-4008-b6a1-12201b9e0b88",
            "referred_other_support":"5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
         }
      },
      {
         "report_name":"COVID Report",
         "flat_table_name":"flat_encounter_covid",
         "encounter_type_uuid":"253a43d3-c99e-415c-8b78-ee7d4d3c1d54",
         "table_columns":{
            "date_assessment":"160753AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "assessment_contact_case":"5340f478-ec5d-41e6-bc62-961c52014d4d",
            "assessment_entry_country":"677f4d21-7293-4810-abe6-57a192acde57",
            "assessment_follow_up":"ad8be6bf-ced7-4390-a6af-c5acebeac216",
            "assessment_health_worker":"30320fb8-b29b-443f-98cf-f3ef491f8947",
            "assessment_frontline_worker":"38769c82-a3d3-4714-97b7-015726cdb209",
            "assessment_post_mortem":"1cee0ab3-bf06-49e9-a49c-baf261620c67",
            "assessment_quarantine":"e0f1584a-cc8b-48e9-980f-64d9f724caf8",
            "assessment_rdt_confirmatory":"0ed2e3ca-b9a6-4ff6-ac74-4d4cd9520acc",
            "assessment_surveillance":"8a6ab892-1b1d-4ad9-82da-c6c38ee8fcfb",
            "assessment_symptomatic":"1068AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "assessment_travel_out_country":"f8c9c2cc-3070-444e-8818-26fb8100bb78",
            "assessment_voluntary":"f974e267-feeb-42be-9d37-61554dad16b1",
            "assessment_other":"a782ce41-5499-4521-ae42-16347fe6b9e0",
            "assessment_presentation":"de3bc9b7-05b5-41b6-a38d-8d2eec646c4f",
            "date_onset_symptoms":"1730AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_abdominal_pain":"151AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_chest_pain":"120749AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_cough":"feb2a008-403c-480e-9d0e-f7100b370815",
            "symptom_diarrhoea":"6e7d9cd7-8a0b-40ca-bf57-c4fc7510b09a",
            "symptom_disturbance_consciousness":"118876AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_general_weakness":"5226AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_headache":"139084AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_fever_chills":"140237AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_irritability_confusion":"120345AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_joint_pain":"116558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_loss_smell":"135589AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_loss_taste":"135589AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_muscular_pain":"133632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_nausea_vomiting":"5978AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_red_eyes":"127777AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_runny_nose":"94a6ae53-0c36-4889-b2b7-025e48542835",
            "symptom_shortness_breath":"141600AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_sneezing":"126319AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_sore_throat":"158843AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_tiredness":"124628AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "symptom_other":"08287bbb-3b2d-41fc-83e6-9c827e79b8e0",
            "comorbidity_present":"166020AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_cardiovascular":"9a40049b-4875-4a1f-8969-d9231b807ec7",
            "comorbidity_chronic_lung":"145270AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_chronic_neurological":"165646AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_current_smoker":"155600AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_diabetes":"e3ea3c4b-df5f-4659-b357-93e3de325660",
            "comorbidity_former_smoker":"156358AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_hiv_aids":"746d0622-21d3-4c57-8ee9-4e2a69637d8c",
            "comorbidity_hypertension":"117399AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_immunodeficiency":"156753AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_liver":"139201AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "comorbidity_malignancy":"c4879004-17d7-4eee-b5fc-942e855e2027",
            "comorbidity_renal":"9c37b227-6426-4866-9fb9-a19800572924",
            "comorbidity_tb":"1a0ce98b-3fc0-4a07-b813-9dad49d8347e",
            "comorbidity_other":"166104AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "covid_test":"069f6dfe-88c1-4a45-a894-0d99549c8718",
            "order_date":"162078AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "rapid_antigen_test":"165852AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "diagnostic_pcr_test":"165840AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "result_date":"163724AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "rapid_antigen_result":"cbcbb029-f11f-4437-9d53-1d0f0a170433",
            "diagnostic_pcr_result":"3f4ee14b-b4ab-4597-9fe9-406883b63d76",
            "patient_outcome":"a845f3e6-4432-4de4-9fff-37fa270b1a06",
            "date_recovered":"162868AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "date_died":"1543AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "long_covid_description":"4560c560-4bd6-4989-bff8-6e4e1fa39972"
         }
      },
      {
         "report_name":"CT Patient Enrolment",
         "flat_table_name":"flat_encounter_patientenrolment",
         "encounter_type_uuid":"7e54cd64-f9c3-11eb-8e6a-57478ce139b0",
         "table_columns":{
            "patient_type" : "83e40f2c-c316-43e6-a12e-20a338100281",
            "pop_type" : "166432AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "reenrolment_date" : "20efadf9-86d3-4498-b3ab-7da4dad9c429",
            "reenrolment_reason" : "14ae2dc9-5964-425a-87e8-9ca525cf055e",
            "date_enrolled" : "160555AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "transferring_facility" : "160535AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "artstart_date" : "159599AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "current_regimen" : "1257AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "transferin_documentation" : "7962d0ed-0fb5-4580-8e46-6fd318091154",
            "date_confirmed_hiv_positive" : "160554AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "test_type" : "ca4953af-9ad4-4514-b54a-6832acd7cae9",
            "previous_haart_pep" : "8bfdc328-1970-446c-9d7b-97d62703801b",
            "date_pep_last_used" : "fbe937b6-a4ad-4ce5-9c43-002222fbabfb",
            "previous_haart_prep" : "5d397775-0155-4033-95dc-edcec98e8190",
            "date_prep_last_used" : "5af829e9-2427-4ed7-bb55-de4381610364",
            "previous_haart_hepatitis" : "906ed69c-949b-47b5-b469-2205f0da473a",
            "date_hepatitis_last_used" : "6a6cbda5-b155-4144-9ff9-ec3d1d1cd509",
            "nnrtis" : "9064043b-5b18-4228-97ff-f0e20aaf9448",
            "nrtis" : "54e7ff9b-4d93-41ba-ad0b-cb5f565785f2",
            "PIs" : "77eed025-0f5c-4173-bf45-36e05a175aaf",
            "other_hivdrugs" : "5424AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "treatmentsupporter_name" : "160638AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "phone_number" : "159635AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "treatmentsupporter_relationship" : "160642AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "notes" : "165095AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
         }
      },
      {
         "report_name":"CT ART Therapy",
         "flat_table_name":"flat_encounter_arttherapy",
         "encounter_type_uuid":"74bf4fe6-8fdb-4228-be39-680a93a9cf6d",
         "table_columns":{
            "art_plan" : "7557d77c-172b-4673-9335-67a38657dd01",
            "artstart_date" : "159599AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "regimen" : "dfbe256e-30ba-4033-837a-2e8477f2e7cd",
            "regimen_line" : "164515AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "regimenline_switched_date" : "164516AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "regimen_substituted_date" : "164431AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "art_stop_reason" : "1252AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "art_stop_date" : "160739AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "art_restart_date" : "160738AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
            "notes" : "165095AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
         }
      },
      {
         "report_name":"UgandaEMR HTS Report",
         "flat_table_name":"flat_encounter_ugemr_hts",
         "encounter_type_uuid":"264daIZd-f80e-48fe-nba9-P37f2W1905Pv",
         "table_columns":{
            "consent_provided":"0698a45b-771c-4d11-84ff-095598c8883c",
            "recency_rtri_result":"141520BBBBBBBBBBBBBBBBBBBBBBBBBBBBBB",
            "initial_kit_name":"16091701-69b8-4bc7-82b3-b1726cf5a5df",
            "pretest_counselling":"193039f1-c378-4d81-bb72-653b66c69914",
            "ever_tested_hiv":"2766c090-c057-44f2-98f0-691b6d0336dc",
            "result_received_couple":"2aa9f0c1-3f7e-49cd-86ee-baac0d2d5f2d",
            "reason_for_test":"2afe1128-c3f6-4b35-b119-d17b9b9958ed",
            "client_linked_care":"3d620422-0641-412e-ab31-5e45b98bc459",
            "hts_approach":"46648b1d-b099-433b-8f9c-3815ff1e0a0f",
            "community_service_point":"4f4e6d1d-4343-42cc-ba47-2319b8a84369",
            "facility_service_point":"720a1e85-ea1c-4f7b-a31e-cb896978df79",
            "referred_prevention_services":"73686a14-b55c-4b10-916d-fda2046b803f",
            "couple_result":"94a5bd0a-b79d-421e-ab71-8e382eed100f",
            "given_result":"ad2884a2-830f-4ca8-bc1e-1e1fd2df0f81",
            "type_pretest_counselling":"b92b1777-4356-49b2-9c83-a799680dc7d4",
            "referred_tb_program":"c5da115d-f6a3-4d13-b182-c2e982a3a796",
            "facility_referred_care":"dce015bb-30ab-102d-86b0-7a5022ba4115"
         }
      }
   ]
}
';

CALL sp_extract_report_metadata(@report_data, 'mamba_dim_concept_metadata');

-- $END